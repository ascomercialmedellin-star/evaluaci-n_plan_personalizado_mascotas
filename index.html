<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Evaluaci√≥n ‚Äî Plan Personalizado de Mascotas (Los Olivos / Previsora Social)</title>
  <style>
    :root{
      --bg:#0b1020; --card:#121836; --ink:#eaf0ff; --muted:#a7b0c9; --accent:#86e1ff; --accent-2:#a1ffa6;
      --warn:#ffd166; --error:#ff6b6b; --ok:#2dd4bf;
    }
    html,body{height:100%}
    body{margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; background:linear-gradient(180deg,var(--bg),#0e1430 60%, #0b1020); color:var(--ink)}
    .wrap{max-width:980px; margin:0 auto; padding:32px 20px 60px}
    header{display:flex; flex-direction:column; gap:8px; margin-bottom:22px}
    h1{font-size:clamp(20px,2.6vw,36px); margin:0; letter-spacing:.2px}
    .sub{color:var(--muted)}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08); border-radius:18px; box-shadow:0 10px 30px rgba(0,0,0,.25); padding:20px}
    .grid{display:grid; grid-template-columns:repeat(12,1fr); gap:14px}
    .controls{position:sticky; top:10px; z-index:10}
    .controls .card{display:flex; flex-wrap:wrap; gap:10px; align-items:center}
    button, .btn{appearance:none; border:1px solid rgba(255,255,255,.18); background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.02)); color:var(--ink); border-radius:14px; padding:10px 14px; font-weight:600; cursor:pointer; transition:transform .08s ease, box-shadow .2s ease; box-shadow:0 6px 14px rgba(0,0,0,.2)}
    button:hover{transform:translateY(-1px)}
    button.primary{border-color:rgba(134,225,255,.6); box-shadow:0 8px 20px rgba(134,225,255,.18)}
    .pill{font-size:12px; color:var(--muted)}
    section.q{margin:16px 0; border:1px dashed rgba(255,255,255,.09); border-radius:14px}
    section.q > header{padding:12px 14px 6px; display:flex; gap:10px; align-items:center}
    section.q h3{margin:0; font-size:16px}
    section.q main{padding:0 14px 14px}
    .k{display:inline-flex; align-items:center; gap:6px; font-size:12px; color:var(--muted)}
    .badge{padding:2px 8px; border-radius:999px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1)}
    .opt{display:block; padding:8px 10px; margin:6px 0; border:1px solid rgba(255,255,255,.08); border-radius:12px}
    textarea{width:100%; min-height:86px; resize:vertical; padding:10px; border-radius:12px; border:1px solid rgba(255,255,255,.1); background:rgba(255,255,255,.04); color:var(--ink)}
    .foot{display:flex; flex-wrap:wrap; align-items:center; gap:12px; justify-content:space-between; margin-top:14px; padding:10px 14px; border-top:1px solid rgba(255,255,255,.06); color:var(--muted)}
    .score{font-weight:700; color:var(--accent-2)}
    .ok{color:var(--ok)} .err{color:var(--error)} .warn{color:var(--warn)}
    details{background:rgba(255,255,255,.03); border-radius:12px; padding:10px 12px; border:1px solid rgba(255,255,255,.06)}
    summary{cursor:pointer}
    .sr{position:absolute; clip:rect(1px,1px,1px,1px); padding:0; border:0; height:1px; width:1px; overflow:hidden}
    a{color:var(--accent)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Evaluaci√≥n ‚Äî Plan Personalizado de Mascotas</h1>
      <div class="sub">Los Olivos / Previsora Social ‚Äî Piloto en agencias de Entidades Due√±as</div>
      <div class="card">
        <p><strong>Instrucciones:</strong> Completa todas las secciones. Algunas preguntas se califican autom√°ticamente (selecci√≥n √∫nica/m√∫ltiple y verdadero/falso). Las preguntas argumentativas ser√°n revisadas por el equipo.</p>
        <div class="pill">Tus respuestas se guardan en este navegador (localmente).</div>
      </div>
    </header>

    <div class="grid">
      <div class="controls card" style="grid-column: span 12">
        <label>Nombre de la asesora: <input id="nombre" placeholder="Tu nombre" style="margin-left:6px; padding:8px; border-radius:10px; border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.04); color:var(--ink)"></label>
        <label>Agencia/Entidad: <input id="agencia" placeholder="Ej. Coop. X / Agencia Y" style="margin-left:6px; padding:8px; border-radius:10px; border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.04); color:var(--ink)"></label>
        <button class="primary" id="btnCalificar">Calificar</button>
        <button id="btnGuardar">Guardar progreso</button>
        <button id="btnLimpiar">Limpiar</button>
        <button id="btnCSV">Exportar respuestas (CSV)</button>
        <span class="pill">Puntaje auto-calificable: <span class="score" id="score">‚Äî</span></span>
      </div>
    </div>

    <div id="form">
      <!-- Las secciones y preguntas provienen del archivo adjunto -->

      <!-- Helper: plantilla de generador -->
    </div>

    <div class="card" style="margin-top:20px">
      <details>
        <summary><strong>Configuraci√≥n (para el equipo)</strong> ‚Äî Clave de respuestas y metadatos</summary>
        <p>La mayor√≠a de preguntas son conceptuales/argumentativas. A continuaci√≥n hay una <em>clave editable</em> para auto-calificar √∫nicamente donde aplique. Edita este bloque JSON directamente en el c√≥digo si necesitas ajustar claves.</p>
        <pre id="answerKeyView" style="white-space:pre-wrap"></pre>
      </details>
    </div>

    <footer class="foot">
      <div>¬© Los Olivos / Previsora Social ‚Äî Evaluaci√≥n del piloto de Plan Personalizado de Mascotas</div>
      <div class="k"><span class="badge">v1.0</span> <span class="badge">Cliente: Web est√°tica</span></div>
    </footer>
  </div>

  <script>
    /***********************
     * ESTRUCTURA DE DATOS *
     ***********************/
    // Tipos: 'single', 'multi', 'bool', 'text'

    const cuestionario = [
      {sec:"üß≠ Secci√≥n 1. Cultura y prop√≥sito organizacional", items:[
        {id:"q1", tipo:"single", prompt:"¬øQu√© significa ‚ÄúLos Olivos‚Äù?", opciones:["Cumplir metas comerciales.","Acompa√±ar con calidez y prop√≥sito en los momentos m√°s importantes de la vida.","Garantizar los procesos administrativos.","Vender servicios funerarios exclusivamente."]},
        {id:"q2", tipo:"single", prompt:"Completa la frase: Vivir Los Olivos es vivir desde...", opciones:["El compromiso, la innovaci√≥n y la empat√≠a.","La ganancia y la rentabilidad.","La agilidad y la productividad.","El liderazgo comercial."]},
        {id:"q3", tipo:"bool", prompt:"Los Olivos es una marca que se enfoca en la gesti√≥n del duelo."},
        {id:"q4", tipo:"text", prompt:"Menciona en tus palabras qu√© valor consideras m√°s representativo de Los Olivos y por qu√©."},
        {id:"q5", tipo:"single", prompt:"¬øQu√© rol cumple Previsora Social Cooperativa Vivir dentro de la red nacional Los Olivos?", opciones:["Gestionar beneficios educativos.","Representar y comercializar el portafolio de previsi√≥n para familias con enfoque social y solidario en la regi√≥n de Antioquia y Choc√≥.","Coordinar la comunicaci√≥n interna.","Proveer servicios de bienestar animal."]},
      ]},

      {sec:"üèõÔ∏è Secci√≥n 2. Estructura de la organizaci√≥n", items:[
        {id:"q6", tipo:"single", prompt:"¬øCu√°ntas entidades due√±as conforman el segmento/canal de Asociadas?", opciones:["25","20","16","M√°s de 30"]},
        {id:"q7", tipo:"bool", prompt:"Cada entidad due√±a tiene agencias/oficinas propias donde se atienden asociados, afiliados y prospectos de afiliados de Los Olivos."},
        {id:"q8", tipo:"single", prompt:"¬øCu√°l es la funci√≥n principal de las agencias/oficinas en el modelo comercial de Previsora Social Cooperativa Vivir y la marca Los Olivos?", opciones:["Ofrecer productos financieros.","Movilizar la venta del portafolio de Los Olivos y fortalecer el v√≠nculo con la base social de las cooperativas.","Gestionar √∫nicamente tr√°mites administrativos.","Atender reclamos de Los Olivos."]},
        {id:"q9", tipo:"text", prompt:"¬øQu√© significa ser una entidad due√±a dentro de Los Olivos? (Pregunta argumentativa)"},
      ]},

      {sec:"üåø Secci√≥n 3. Marca y prop√≥sito de Los Olivos", items:[
        {id:"q10", tipo:"multi", prompt:"¬øCu√°l es (son) el(los) prop√≥sito(s) principal de la marca Los Olivos? (selecciona las que consideres necesarias)", opciones:["Ser l√≠deres en previsi√≥n familiar.","Cuidar a las personas en todas las etapas de la vida.","Trascender a trav√©s del servicio y el acompa√±amiento.","Brindar apoyo econ√≥mico en momentos imprevistos.","Innovar con un portafolio de servicios diferencial en el sector."]},
        {id:"q11", tipo:"single", prompt:"¬øQu√© emoci√≥n busca generar Los Olivos en sus afiliados?", opciones:["Urgencia","Seguridad y confianza","Alegr√≠a","Competencia"]},
        {id:"q12", tipo:"text", prompt:"¬øPor qu√© es importante que las asesoras comprendan el ADN de la marca? (Pregunta argumentativa)"},
      ]},

      {sec:"üíº Secci√≥n 4. Portafolio de previsi√≥n y servicios", items:[
        {id:"q13", tipo:"single", prompt:"¬øC√≥mo se compone el portafolio de Previsora Social?", opciones:["Servicios funerarios, exequiales y de bienestar animal.","Planes de previsi√≥n familiar (para mascotas y personas), bienestar y convenios aliados.","Planes de ahorro e inversi√≥n.","Solo servicios funerarios."]},
        {id:"q14", tipo:"bool", prompt:"Los planes de previsi√≥n solo se pueden adquirir de manera presencial."},
        {id:"q15", tipo:"text", prompt:"¬øQu√© diferencia el portafolio de Previsora Social Cooperativa Vivir frente a otras empresas similares del sector? (Pregunta argumentativa)"},
      ]},

      {sec:"üêæ Secci√≥n 5. Importancia del segmento de mascotas", items:[
        {id:"q16", tipo:"multi", prompt:"¬øPor qu√© el segmento de mascotas es tan importante para Los Olivos? (selecciona todas las que consideres correctas)", opciones:[
          "Porque es una tendencia comercial.",
          "Porque son parte de la familia y reflejan nuestro prop√≥sito de cuidar v√≠nculos.",
          "Porque es un servicio muy rentable de cara al negocio.",
          "Porque reemplaza otros planes.",
          "Porque las mascotas est√°n de moda.",
          "Porque las mascotas son muy tiernas.",
          "Porque tenemos una gran oportunidad al no tener a√∫n la penetraci√≥n deseada de afiliaciones en nuestras familias activas.",
          "Porque podemos incursionar en otras categor√≠as del ecosistema de mascotas que ofrecen oportunidad de negocio para Los Olivos."
        ]},
        {id:"q17", tipo:"text", prompt:"¬øC√≥mo se conecta el cuidado de las mascotas con el prop√≥sito de ‚Äúacompa√±ar la vida‚Äù? (Pregunta argumentativa)"},
        {id:"q18", tipo:"bool", prompt:"El plan de mascotas se puede vender de forma independiente del portafolio de previsi√≥n familiar."},
      ]},

      {sec:"üì¶ Secci√≥n 6. Portafolio de planes de mascotas", items:[
        {id:"q19", tipo:"single", prompt:"¬øCu√°les son los principales planes de mascotas ofrecidos actualmente?", opciones:[
          "B√°sico, Club, Personalizado.",
          "Familiar, Club de Amigos y Personalizado.",
          "Previsi√≥n Exequial, Club de Amigos ‚Äì Plan Integral de Mascotas, y Plan Personalizado de Mascotas.",
          "Previsi√≥n Exequial, Club Integral Mascotas y Plan Personalizado de Mascotas."
        ]},
        {id:"q20", tipo:"single", prompt:"¬øQu√© diferencia al plan personalizado de los dem√°s?", opciones:[
          "Se adapta a las necesidades del afiliado y su mascota.",
          "Permite elegir coberturas adicionales espec√≠ficas.",
          "Tiene un precio diferenciado por edad de la mascota.",
          "Todas las anteriores."
        ]},
        {id:"q21", tipo:"bool", prompt:"En el Plan Personalizado de Mascotas se pueden cambiar o modificar las coberturas del Plan Base."},
        {id:"q22", tipo:"text", prompt:"Lista todas las coberturas ADICIONALES que pueden ser adquiridas por el afiliado en el Plan Personalizado de Mascotas."},
      ]},

      {sec:"üí∞ Secci√≥n 7. Tarifas y beneficios", items:[
        {id:"q23", tipo:"single", prompt:"¬øQu√© factores determinan la tarifa del Plan Personalizado de Mascotas?", opciones:[
          "Edad, raza y tama√±o del animal, y descuento.",
          "Ciudad de residencia.",
          "Edad, cantidad de coberturas adicionales, descuento, y periodicidad de pago.",
          "Edad, descuento, entidad, agencia, y periodicidad."
        ]},
        {id:"q24", tipo:"text", prompt:"¬øCu√°les son los rangos de edad para afiliaci√≥n del Plan Personalizado de Mascotas y las primas mensuales de pago de cada uno (tarifas)?"},
        {id:"q25", tipo:"bool", prompt:"Tenemos disponible 10% de descuento para Plan Base y Coberturas Adicionales durante la etapa de lanzamiento y prueba piloto."},
        {id:"q26", tipo:"text", prompt:"¬øHasta cu√°ndo dura la prueba piloto del Plan Personalizado de Mascotas y cu√°les son las hip√≥tesis que se quieren validar?"},
      ]},

      {sec:"üè¢ Secci√≥n 8. Entidades y agencias en prueba piloto", items:[
        {id:"q27", tipo:"text", prompt:"¬øEn cu√°les entidades due√±as y agencias se desarrolla la prueba piloto del Plan Personalizado de Mascotas?"},
        {id:"q28", tipo:"text", prompt:"¬øEs posible vender el Plan Personalizado de Mascotas en otras agencias/oficinas que no pertenezcan al piloto? (Argumentar respuesta.)"},
        {id:"q29", tipo:"text", prompt:"Aparte de las Entidades Due√±as y sus agencias mencionadas, ¬øen que otro canal o segmento est√° habilitado el Plan Personalizado de Mascotas para su venta?"},
      ]},

      {sec:"üí¨ Secci√≥n 9. Rol de la asesora comercial", items:[
        {id:"q30", tipo:"multi", prompt:"¬øCu√°l es el principal objetivo de la asesora en este piloto? (Selecciona todas las que consideres necesarias)", opciones:[
          "Cumplir la meta de ventas propuesta.",
          "Movilizar el conocimiento del producto y conectar con los asesores y directores de las agencias.",
          "Promover el buen relacionamiento con la fuerza comercial de las entidades due√±as.",
          "Recopilar las sugerencias, quejas y oportunidades de mejora del piloto.",
          "Hacer seguimiento a los resultados de ventas del piloto y compartirlos con los directores de agencia y contactos de E.D.",
          "Ser una gu√≠a experta con conocimiento pleno del Plan Personalizado de Mascotas."
        ]},
        {id:"q31", tipo:"text", prompt:"¬øQu√© tipo de perfil debe proyectar una asesora de Los Olivos? (Pregunta argumentativa)"},
        {id:"q32", tipo:"bool", prompt:"Lo m√°s importante es conocer las tarifas y promociones."},
        {id:"q33", tipo:"multi", prompt:"¬øQu√© recursos tiene disponibles para apoyar su labor?", opciones:[
          "Material POP",
          "Capacitaci√≥n continua",
          "Acompa√±amiento del equipo de Investigaci√≥n y Desarrollo",
          "Caja de Herramientas",
          "Documentaci√≥n, presentaciones del Plan Personalizado de Mascotas",
          "Cursos de la Comunidad de Conocimiento"
        ]},
      ]},

      {sec:"üéØ Secci√≥n 10. Estrategia comercial y experiencia del afiliado", items:[
        {id:"q34", tipo:"text", prompt:"¬øQu√© elemento diferencia la venta relacional de la venta transaccional? (Respuesta argumentativa)"},
        {id:"q35", tipo:"single", prompt:"¬øQu√© estrategias puede usar la asesora para generar confianza con los afiliados de agencias?", opciones:["Escucha activa y empat√≠a.","Ofrecer promociones r√°pidas.","Presionar la compra inmediata.","Focalizar en datos fr√≠os."]},
        {id:"q36", tipo:"bool", prompt:"Cada contacto con un asociado o afiliado es una oportunidad para comunicar el prop√≥sito de la marca y del Plan Personalizado de Mascotas."},
        {id:"q37", tipo:"single", prompt:"Completa: Un afiliado satisfecho es...", opciones:["El que compra m√°s.","El que siente que lo acompa√±amos en su historia y permanece m√°s tiempo afiliado a los planes de previsi√≥n.","El que no reclama.","El que paga a tiempo."]},
      ]},

      {sec:"üìö Secci√≥n 11. Conocimiento t√©cnico y operativo", items:[
        {id:"q38", tipo:"text", prompt:"¬øQu√© pasos debe seguir una asesora para formalizar la afiliaci√≥n del Plan Personalizado de Mascotas en Karing? (Respuesta abierta o en secuencia)"},
        {id:"q39", tipo:"bool", prompt:"Es posible que una persona que ya est√° afiliada a planes de mascotas antiguos se pase (migre) al Plan Personalizado de Mascotas."},
        {id:"q40", tipo:"single", prompt:"¬øQu√© documentos debe tener el afiliado para suscribir el Plan Personalizado de Mascotas?", opciones:[
          "C√©dula, datos de contacto, nombre, especie, peso, raza, y fecha de nacimiento exacta de la mascota.",
          "C√©dula, datos de contacto, nombre, especie, peso, raza, y fecha de nacimiento exacta o aproximada de la mascota.",
          "C√©dula, datos de contacto, nombre, especie, peso, raza, y fecha de nacimiento exacta de la mascota, carn√© de vacunaci√≥n.",
          "C√©dula, datos de contacto, nombre, especie, peso, raza, y fecha y lugar de nacimiento de la mascota."
        ]},
        {id:"q41", tipo:"text", prompt:"¬øC√≥mo se gestiona una solicitud de cambio o migraci√≥n al nuevo Plan Personalizado de Mascotas? (Pregunta argumentativa)"},
      ]},

      {sec:"üß© Secci√≥n 12. Conocimiento situacional y valores", items:[
        {id:"q42", tipo:"text", prompt:"Si un afiliado expresa que ‚Äúno necesita un plan para su mascota‚Äù, ¬øqu√© responder√≠as para conectar con su emoci√≥n y mostrar valor? (Pregunta argumentativa)"},
        {id:"q43", tipo:"text", prompt:"Si un afiliado expresa que el ‚Äúel plan es muy caro‚Äù ¬øc√≥mo podr√≠as debatir su objeci√≥n?"},
        {id:"q44", tipo:"single", prompt:"¬øQu√© diferencia a Los Olivos de otras marcas que ofrecen planes para mascotas?", opciones:["Su prop√≥sito, acompa√±amiento humano y coberturas deseadas.","Su enfoque transaccional.","Sus descuentos agresivos."]},
        {id:"q45", tipo:"text", prompt:"¬øQu√© significa para ti acompa√±ar la vida con prop√≥sito? (Pregunta argumentativa)"},
      ]},

      {sec:"üìà Secci√≥n 13. Evaluaci√≥n de desempe√±o comercial", items:[
        {id:"q46", tipo:"multi", prompt:"¬øQu√© indicadores miden la efectividad de una asesora en el piloto? (selecciona todas las que consideres)", opciones:[
          "Ventas logradas",
          "Conexi√≥n emocional con los equipos comercial de entidades due√±as.",
          "Retroalimentaci√≥n positiva de los directores de agencias.",
          "Retroalimentaci√≥n del equipo de Investigaci√≥n y Desarrollo."
        ]},
        {id:"q47", tipo:"bool", prompt:"Solo las ventas cuantitativas definen el √©xito del piloto."},
        {id:"q48", tipo:"text", prompt:"Resume de manera general tu misi√≥n en la prueba piloto del Plan Personalizado de Mascotas."},
      ]},

      {sec:"üí° Secci√≥n 14. Retroalimentaci√≥n personal", items:[
        {id:"q49", tipo:"text", prompt:"¬øQu√© aprendizaje te ha dejado este proceso de formaci√≥n? (Pregunta abierta)"},
        {id:"q50", tipo:"text", prompt:"¬øQu√© aspectos del plan o del acompa√±amiento te gustar√≠a fortalecer? (Pregunta abierta)"},
      ]},
    ];

    // Clave de respuestas (auto-calificables). √çndices base 0 para opciones.
    // Deja null para preguntas argumentativas o que se eval√∫an manualmente.
    const answerKey = {
      // Secci√≥n 1
      q1:{type:"single", correct:1},
      q2:{type:"single", correct:0}, // editable
      q3:{type:"bool", correct:false},
      q5:{type:"single", correct:1},
      // Secci√≥n 2
      q6:{type:"single", correct:null}, // editar seg√∫n dato oficial
      q7:{type:"bool", correct:true},
      q8:{type:"single", correct:1},
      // Secci√≥n 3
      q10:{type:"multi", correct:[1,2,4]}, // editable
      q11:{type:"single", correct:1},
      // Secci√≥n 4
      q13:{type:"single", correct:1},
      q14:{type:"bool", correct:false},
      // Secci√≥n 5
      q16:{type:"multi", correct:[1,6,7]}, // puedes a√±adir 7 y 8 si aplica
      q18:{type:"bool", correct:null},
      // Secci√≥n 6
      q19:{type:"single", correct:2},
      q20:{type:"single", correct:3},
      q21:{type:"bool", correct:null},
      // Secci√≥n 7
      q23:{type:"single", correct:2},
      q25:{type:"bool", correct:null},
      // Secci√≥n 9
      q30:{type:"multi", correct:[1,2,3,4,5]},
      q32:{type:"bool", correct:false},
      q33:{type:"multi", correct:[0,1,2,3,4,5]},
      // Secci√≥n 10
      q35:{type:"single", correct:0},
      q36:{type:"bool", correct:true},
      q37:{type:"single", correct:null},
      // Secci√≥n 11
      q39:{type:"bool", correct:null},
      q40:{type:"single", correct:1},
      // Secci√≥n 12
      q44:{type:"single", correct:0},
      // Secci√≥n 13
      q46:{type:"multi", correct:null},
      q47:{type:"bool", correct:false},
    };

    /***********************
     * RENDER DE FORMULARIO *
     ***********************/
    const formEl = document.getElementById('form');

    function createQuestionEl(item, idx){
      const sec = document.createElement('section');
      sec.className = 'q card';
      const h = document.createElement('header');
      const h3 = document.createElement('h3');
      h3.textContent = `${idx}. ${item.prompt}`;
      h.appendChild(h3);
      const k = document.createElement('div');
      k.className = 'k';
      const kind = {single:'Selecci√≥n √∫nica', multi:'Selecci√≥n m√∫ltiple', bool:'Verdadero/Falso', text:'Respuesta abierta'}[item.tipo] || '';
      k.innerHTML = `<span class="badge">${kind}</span>`;
      h.appendChild(k);
      sec.appendChild(h);

      const main = document.createElement('main');
      if(item.tipo==='single'){
        item.opciones.forEach((op, i)=>{
          const id = `${item.id}_${i}`;
          const label = document.createElement('label');
          label.className='opt';
          label.innerHTML = `<input type="radio" name="${item.id}" value="${i}" id="${id}"> ${op}`;
          main.appendChild(label);
        });
      }
      if(item.tipo==='multi'){
        item.opciones.forEach((op, i)=>{
          const id = `${item.id}_${i}`;
          const label = document.createElement('label');
          label.className='opt';
          label.setAttribute('class','opt');
          label.innerHTML = `<input type="checkbox" name="${item.id}" value="${i}" id="${id}"> ${op}`;
          main.appendChild(label);
        });
      }
      if(item.tipo==='bool'){
        const trueId = `${item.id}_t`; const falseId = `${item.id}_f`;
        const l1 = document.createElement('label'); l1.className='opt';
        l1.innerHTML = `<input type="radio" name="${item.id}" value="true" id="${trueId}"> Verdadero`;
        const l2 = document.createElement('label'); l2.className='opt';
        l2.innerHTML = `<input type="radio" name="${item.id}" value="false" id="${falseId}"> Falso`;
        main.appendChild(l1); main.appendChild(l2);
      }
      if(item.tipo==='text'){
        const ta = document.createElement('textarea'); ta.name=item.id; ta.placeholder='Escribe tu respuesta...';
        main.appendChild(ta);
      }
      sec.appendChild(main);

      const foot = document.createElement('div');
      foot.className='foot';
      const status = document.createElement('div'); status.id = `${item.id}_status`; status.className='pill'; status.textContent='Sin responder';
      foot.appendChild(status);
      const hint = document.createElement('div'); hint.className='pill'; hint.textContent='';
      foot.appendChild(hint);
      sec.appendChild(foot);
      return sec;
    }

    // Render por secciones con numeraci√≥n continua
    let num = 1;
    cuestionario.forEach(b=>{
      const secTitle = document.createElement('h2');
      secTitle.textContent = b.sec;
      secTitle.style.marginTop = '28px';
      formEl.appendChild(secTitle);
      b.items.forEach(it=>{
        const el = createQuestionEl(it, num++);
        formEl.appendChild(el);
      })
    });

    // Mostrar clave
    document.getElementById('answerKeyView').textContent = JSON.stringify(answerKey, null, 2);

    /***********************
     * PERSISTENCIA (Local) *
     ***********************/
    const LS_KEY = 'evaluacion_mascotas_respuestas_v1';

    function getResponses(){
      const data = {nombre:document.getElementById('nombre').value, agencia:document.getElementById('agencia').value, respuestas:{}};
      cuestionario.forEach(b=> b.items.forEach(it=>{
        if(it.tipo==='single' || it.tipo==='bool'){
          const sel = document.querySelector(`[name="${it.id}"]:checked`);
          data.respuestas[it.id] = sel ? sel.value : null;
        } else if(it.tipo==='multi'){
          const sels = [...document.querySelectorAll(`[name="${it.id}"]:checked`)].map(x=>parseInt(x.value));
          data.respuestas[it.id] = sels;
        } else if(it.tipo==='text'){
          const ta = document.querySelector(`textarea[name="${it.id}"]`);
          data.respuestas[it.id] = ta?.value || '';
        }
      }))
      return data;
    }

    function setResponses(data){
      if(!data) return;
      document.getElementById('nombre').value = data.nombre || '';
      document.getElementById('agencia').value = data.agencia || '';
      cuestionario.forEach(b=> b.items.forEach(it=>{
        const val = data.respuestas?.[it.id];
        if(val==null) return;
        if(it.tipo==='single'){
          const input = document.querySelector(`[name="${it.id}"][value="${val}"]`);
          if(input) input.checked = true;
        } else if(it.tipo==='bool'){
          const input = document.querySelector(`[name="${it.id}"][value="${val}"]`);
          if(input) input.checked = true;
        } else if(it.tipo==='multi'){
          if(Array.isArray(val)){
            val.forEach(v=>{
              const input = document.querySelector(`[name="${it.id}"][value="${v}"]`);
              if(input) input.checked = true;
            });
          }
        } else if(it.tipo==='text'){
          const ta = document.querySelector(`textarea[name="${it.id}"]`);
          if(ta) ta.value = val;
        }
      }))
    }

    function save(){ localStorage.setItem(LS_KEY, JSON.stringify(getResponses())); }
    function load(){ const raw = localStorage.getItem(LS_KEY); if(raw){ try{ setResponses(JSON.parse(raw)); }catch(e){} } }
    function clearAll(){ localStorage.removeItem(LS_KEY); location.reload(); }

    document.getElementById('btnGuardar').addEventListener('click', ()=>{ save(); alert('Progreso guardado en este navegador.'); });
    document.getElementById('btnLimpiar').addEventListener('click', ()=>{ if(confirm('Esto borrar√° todas las respuestas guardadas en este navegador.')) clearAll(); });

    load();

    /***********************
     * CALIFICACI√ìN         *
     ***********************/
    function arraysEqual(a,b){ if(!Array.isArray(a) || !Array.isArray(b)) return false; if(a.length!==b.length) return false; const A=[...a].sort(), B=[...b].sort(); return A.every((v,i)=> v===B[i]); }

    function grade(){
      const data = getResponses();
      let correct = 0, total = 0;
      cuestionario.forEach(b=> b.items.forEach(it=>{
        const key = answerKey[it.id];
        const statusEl = document.getElementById(`${it.id}_status`);
        const val = data.respuestas[it.id];
        if(!key){ statusEl.textContent = 'Se eval√∫a manualmente'; statusEl.className='pill warn'; return; }
        if(key.correct==null){ statusEl.textContent = 'Se eval√∫a manualmente'; statusEl.className='pill warn'; return; }
        total++;
        let ok=false;
        if(key.type==='single') ok = (parseInt(val)===key.correct);
        if(key.type==='bool') ok = (String(val)===String(key.correct));
        if(key.type==='multi') ok = arraysEqual(val, key.correct);
        statusEl.textContent = ok? '‚úì Correcta' : '‚úó Incorrecta';
        statusEl.className = 'pill ' + (ok? 'ok' : 'err');
        if(ok) correct++;
      }));
      const scoreEl = document.getElementById('score');
      scoreEl.textContent = total? `${correct} / ${total} (${Math.round(correct*100/total)}%)` : '‚Äî';
      return {correct,total};
    }

    document.getElementById('btnCalificar').addEventListener('click', grade);

    /***********************
     * EXPORTAR A CSV       *
     ***********************/
    function toCSV(){
      const data = getResponses();
      const rows = [["Nombre","Agencia","ID","Pregunta","Tipo","Respuesta"]];
      let idx = 1;
      cuestionario.forEach(b=> b.items.forEach(it=>{
        let r = data.respuestas[it.id];
        if(Array.isArray(r)) r = r.join('|');
        rows.push([data.nombre, data.agencia, it.id, `${idx}. ${it.prompt}`.replace(/\n/g,' '), it.tipo, (r??'')]);
        idx++;
      }));
      const csv = rows.map(r=> r.map(x=> '"'+String(x).replace(/"/g,'""')+'"').join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='respuestas_evaluacion_mascotas.csv'; a.click(); URL.revokeObjectURL(url);
    }
    document.getElementById('btnCSV').addEventListener('click', toCSV);
  </script>
</body>
</html>
